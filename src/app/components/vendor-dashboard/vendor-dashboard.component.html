<app-layout>
  <div class="flex h-screen bg-gray-50">
    <!-- Sidebar -->
    <div class="w-64 bg-white shadow-sm border-r border-gray-200 flex flex-col">
      <!-- Header -->
      <div class="p-6 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-xl font-bold text-gray-900">Vendor Portal</h1>
            <p class="text-sm text-gray-600 mt-1">{{user?.name}}</p>
          </div>
          <button
            (click)="showResourceModal = true"
            class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200">
            <lucide-icon name="plus" class="w-4 h-4"></lucide-icon>
          </button>
        </div>
      </div>

      <!-- Navigation Menu -->
      <nav class="flex-1 p-4 space-y-2">
        @for (tab of [
          { id: 'overview', label: 'Overview', icon: 'home' },
          { id: 'resources', label: 'My Resources', icon: 'users' },
          { id: 'requirements', label: 'Opportunities', icon: 'briefcase' },
          { id: 'applications', label: 'Applications', icon: 'trending-up' }
        ]; track tab.id) {
          <button
            (click)="setActiveTab(tab.id)"
            [class]="'w-full flex items-center px-4 py-3 text-left rounded-lg transition-colors ' + 
              (activeTab === tab.id
                ? 'bg-blue-50 text-blue-700 border border-blue-200'
                : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900')">
            <lucide-icon [name]="tab.icon" class="w-5 h-5 mr-3"></lucide-icon>
            <span class="font-medium">{{tab.label}}</span>
          </button>
        }

        <!-- Vendor Management Dropdown -->
        <div class="vendor-management-dropdown relative">
          <button
            (click)="toggleVendorManagementDropdown()"
            [class]="'w-full flex items-center justify-between px-4 py-3 text-left rounded-lg transition-colors ' + 
              (['user-management', 'skill-management'].includes(activeTab)
                ? 'bg-blue-50 text-blue-700 border border-blue-200'
                : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900')">
            <div class="flex items-center">
              <lucide-icon name="users" class="w-5 h-5 mr-3"></lucide-icon>
              <span class="font-medium">Vendor Management</span>
            </div>
            <lucide-icon 
              name="chevron-down" 
              [class]="'w-4 h-4 transition-transform ' + (showVendorManagementDropdown ? 'rotate-180' : '')">
            </lucide-icon>
          </button>
          
          @if (showVendorManagementDropdown) {
            <div class="mt-1 ml-4 space-y-1 border-l-2 border-gray-200 pl-4">
              <button
                (click)="setActiveTab('user-management')"
                [class]="'w-full flex items-center px-3 py-2 text-left rounded-lg transition-colors text-sm ' + 
                  (activeTab === 'user-management'
                    ? 'bg-blue-50 text-blue-700'
                    : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900')">
                <lucide-icon name="user" class="w-4 h-4 mr-2"></lucide-icon>
                <span>User Management</span>
              </button>
              <button
                (click)="setActiveTab('skill-management')"
                [class]="'w-full flex items-center px-3 py-2 text-left rounded-lg transition-colors text-sm ' + 
                  (activeTab === 'skill-management'
                    ? 'bg-blue-50 text-blue-700'
                    : 'text-gray-600 hover:bg-gray-50 hover:text-gray-900')">
                <lucide-icon name="briefcase" class="w-4 h-4 mr-2"></lucide-icon>
                <span>Skill Management</span>
              </button>
            </div>
          }
        </div>
      </nav>

      <!-- Stats Summary -->
      <div class="p-4 border-t border-gray-200">
        <div class="space-y-3">
          @for (stat of stats; track stat.title) {
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <div [class]="'p-2 rounded-lg ' + stat.bg">
                  <lucide-icon [name]="stat.icon" [class]="'w-4 h-4 ' + stat.color"></lucide-icon>
                </div>
                <span class="ml-3 text-sm font-medium text-gray-700">{{stat.title}}</span>
              </div>
              <span class="text-lg font-bold text-gray-900">{{stat.value}}</span>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Content Header -->
      <div class="bg-white border-b border-gray-200 px-6 py-4">
        <div class="flex items-center justify-between">
          <div>
            <h2 class="text-2xl font-bold text-gray-900">
              @switch (activeTab) {
                @case ('overview') { Dashboard Overview }
                @case ('resources') { My Resources }
                @case ('requirements') { Opportunities }
                @case ('applications') { Applications }
                @case ('user-management') { User Management }
                @default { Skill Management }
              }
            </h2>
            <p class="text-gray-600 mt-1">
              @switch (activeTab) {
                @case ('overview') { Welcome back to your dashboard }
                @case ('resources') { Manage your available resources }
                @case ('requirements') { Explore new business opportunities }
                @case ('applications') { Track your resource applications }
                @case ('user-management') { Manage organization users and permissions }
                @default { Manage your organization's skill portfolio }
              }
            </p>
          </div>
          @if (activeTab === 'resources') {
            <button
              (click)="showResourceModal = true"
              class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 flex items-center">
              <lucide-icon name="plus" class="w-4 h-4 mr-2"></lucide-icon>
              Add Resource
            </button>
          }
          @if (activeTab === 'user-management') {
            <button
              (click)="showAddUserModal = true"
              class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 flex items-center">
              <lucide-icon name="plus" class="w-4 h-4 mr-2"></lucide-icon>
              Add User
            </button>
          }
          @if (activeTab === 'skill-management') {
            <button
              (click)="showAddSkillModal = true"
              class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-indigo-700 transition-all duration-200 flex items-center">
              <lucide-icon name="plus" class="w-4 h-4 mr-2"></lucide-icon>
              Add Skill
            </button>
          }
        </div>
      </div>

      <!-- Content Area -->
      <div class="flex-1 overflow-y-auto p-6">
        @switch (activeTab) {
          @case ('overview') {
            <div class="space-y-6">
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Recent Applications -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                  <div class="p-6 border-b border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900">Recent Applications</h3>
                  </div>
                  <div class="p-6">
                    @for (app of vendorApplications.slice(0, 5); track app.id) {
                      <div class="flex items-center justify-between py-3 border-b border-gray-100 last:border-0">
                        <div>
                          <p class="font-medium text-gray-900">{{getResourceName(app.resourceId)}}</p>
                          <p class="text-sm text-gray-600">{{getRequirementTitle(app.requirementId)}}</p>
                        </div>
                        <span [class]="'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' + getStatusBadge(app.status).color">
                          <lucide-icon [name]="getStatusBadge(app.status).icon" class="w-3 h-3 mr-1"></lucide-icon>
                          {{formatStatus(app.status)}}
                        </span>
                      </div>
                    }
                    @if (vendorApplications.length === 0) {
                      <p class="text-gray-500 text-center py-8">No applications yet</p>
                    }
                  </div>
                </div>

                <!-- Top Requirements -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100">
                  <div class="p-6 border-b border-gray-100">
                    <h3 class="text-lg font-semibold text-gray-900">Latest Opportunities</h3>
                  </div>
                  <div class="p-6">
                    @for (req of requirements.slice(0, 5); track req.id) {
                      <div class="py-3 border-b border-gray-100 last:border-0">
                        <div class="flex justify-between items-start">
                          <div>
                            <p class="font-medium text-gray-900">{{req.title}}</p>
                            <p class="text-sm text-gray-600">{{req.clientName}}</p>
                            <div class="flex items-center mt-1 space-x-4">
                              <span class="text-xs text-gray-500">${{req.budget}}/hr</span>
                              <span class="text-xs text-gray-500">{{req.duration}}</span>
                            </div>
                          </div>
                          <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">
                            {{req.status}}
                          </span>
                        </div>
                      </div>
                    }
                  </div>
                </div>
              </div>

              <!-- Quick Actions -->
              <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <button
                    (click)="showResourceModal = true"
                    class="p-4 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors text-left">
                    <lucide-icon name="plus" class="w-6 h-6 text-blue-600 mb-2"></lucide-icon>
                    <h4 class="font-medium text-gray-900">Add New Resource</h4>
                    <p class="text-sm text-gray-600 mt-1">Add a new resource to your portfolio</p>
                  </button>
                  
                  <button
                    (click)="setActiveTab('requirements')"
                    class="p-4 border border-gray-200 rounded-lg hover:border-green-300 hover:bg-green-50 transition-colors text-left">
                    <lucide-icon name="briefcase" class="w-6 h-6 text-green-600 mb-2"></lucide-icon>
                    <h4 class="font-medium text-gray-900">Browse Opportunities</h4>
                    <p class="text-sm text-gray-600 mt-1">Find new requirements to apply your resources</p>
                  </button>
                  
                  <button
                    (click)="setActiveTab('applications')"
                    class="p-4 border border-gray-200 rounded-lg hover:border-purple-300 hover:bg-purple-50 transition-colors text-left">
                    <lucide-icon name="trending-up" class="w-6 h-6 text-purple-600 mb-2"></lucide-icon>
                    <h4 class="font-medium text-gray-900">Track Applications</h4>
                    <p class="text-sm text-gray-600 mt-1">Monitor the status of your applications</p>
                  </button>
                </div>
              </div>
            </div>
          }

          @case ('resources') {
            <div class="bg-white rounded-xl shadow-sm border border-gray-100">
              <div class="p-6 border-b border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900">My Resources</h3>
              </div>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Resource</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Skills</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Experience</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rate</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    @for (resource of vendorResources; track resource.id) {
                      <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div>
                            <div class="text-sm font-medium text-gray-900">{{resource.name}}</div>
                            <div class="text-sm text-gray-500">{{resource.location}}</div>
                          </div>
                        </td>
                        <td class="px-6 py-4">
                          <div class="flex flex-wrap gap-1">
                            @for (skill of getFirstThreeSkills(resource.skills); track skill) {
                              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                {{skill}}
                              </span>
                            }
                            @if (resource.skills.length > 3) {
                              <span class="text-xs text-gray-500">
                                +{{resource.skills.length - 3}} more
                              </span>
                            }
                          </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {{resource.experience}} years
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          ${{resource.rate}}/hr
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span [class]="'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' + getAvailabilityClass(resource.availability)">
                            {{resource.availability}}
                          </span>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
                @if (vendorResources.length === 0) {
                  <div class="text-center py-12">
                    <lucide-icon name="users" class="mx-auto h-12 w-12 text-gray-400"></lucide-icon>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">No resources</h3>
                    <p class="mt-1 text-sm text-gray-500">Get started by adding your first resource.</p>
                    <div class="mt-6">
                      <button
                        (click)="showResourceModal = true"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Add Resource
                      </button>
                    </div>
                  </div>
                }
              </div>
            </div>
          }

          @case ('requirements') {
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              @for (req of requirements; track req.id) {
                <div class="bg-white border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                  <div class="flex justify-between items-start mb-4">
                    <h4 class="text-lg font-semibold text-gray-900">{{req.title}}</h4>
                    <span class="text-sm bg-green-100 text-green-800 px-2 py-1 rounded-full">
                      {{req.status}}
                    </span>
                  </div>
                  <p class="text-gray-600 mb-4">{{req.description}}</p>
                  <div class="space-y-2">
                    <div class="flex items-center justify-between text-sm">
                      <span class="text-gray-500">Company:</span>
                      <span class="font-medium">{{req.clientName}}</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                      <span class="text-gray-500">Budget:</span>
                      <span class="font-medium">${{req.budget}}/hr</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                      <span class="text-gray-500">Duration:</span>
                      <span class="font-medium">{{req.duration}}</span>
                    </div>
                    <div class="flex items-center justify-between text-sm">
                      <span class="text-gray-500">Location:</span>
                      <span class="font-medium">{{req.location}}</span>
                    </div>
                  </div>
                  <div class="mt-4">
                    <div class="flex flex-wrap gap-1">
                      @for (skill of req.skills; track skill) {
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                          {{skill}}
                        </span>
                      }
                    </div>
                  </div>
                  <div class="mt-4 pt-4 border-t border-gray-100">
                    <button 
                      (click)="handleApplyResources(req.id)"
                      class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                      Apply Resources
                    </button>
                  </div>
                </div>
              }
            </div>
          }

          @case ('applications') {
            <app-applications-view userRole="vendor"></app-applications-view>
          }

          @case ('user-management') {
            <div class="bg-white rounded-xl shadow-sm border border-gray-100">
              <div class="p-6 border-b border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900">Organization Users</h3>
                <p class="text-sm text-gray-600 mt-1">Manage users in your organization</p>
              </div>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Department</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    @for (user of organizationUsers; track user.id) {
                      <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div>
                            <div class="text-sm font-medium text-gray-900">{{user.name}}</div>
                            <div class="text-sm text-gray-500">{{user.email}}</div>
                            @if (user.phone) {
                              <div class="text-xs text-gray-400">{{user.phone}}</div>
                            }
                          </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span [class]="'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' + getUserRoleClass(user.role)">
                            {{user.role | titlecase}}
                          </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {{user.department || 'N/A'}}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span [class]="'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' + getUserStatusClass(user.status)">
                            {{user.status | titlecase}}
                          </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          {{user.createdAt | date}}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                          <button
                            (click)="toggleUserStatus(user.id, user.status)"
                            [class]="'text-sm px-3 py-1 rounded-lg transition-colors ' + 
                              (user.status === 'active' 
                                ? 'text-red-600 hover:bg-red-50' 
                                : 'text-green-600 hover:bg-green-50')">
                            {{user.status === 'active' ? 'Deactivate' : 'Activate'}}
                          </button>
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
                @if (organizationUsers.length === 0) {
                  <div class="text-center py-12">
                    <lucide-icon name="user" class="mx-auto h-12 w-12 text-gray-400"></lucide-icon>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">No users added</h3>
                    <p class="mt-1 text-sm text-gray-500">Get started by adding your first organization user.</p>
                    <div class="mt-6">
                      <button
                        (click)="showAddUserModal = true"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Add User
                      </button>
                    </div>
                  </div>
                }
              </div>
            </div>
          }

          @default {
            <div class="bg-white rounded-xl shadow-sm border border-gray-100">
              <div class="p-6 border-b border-gray-100">
                <h3 class="text-lg font-semibold text-gray-900">Organization Skills</h3>
                <p class="text-sm text-gray-600 mt-1">Manage your organization's skill portfolio</p>
              </div>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Skill</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Proficiency</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Submitted By</th>
                      <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200">
                    @for (skill of organizationSkills; track skill.id) {
                      <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                          <div>
                            <div class="text-sm font-medium text-gray-900">{{skill.skillName}}</div>
                            @if (skill.description) {
                              <div class="text-xs text-gray-500 mt-1">{{skill.description}}</div>
                            }
                          </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {{skill.category}}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span [class]="'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' + getProficiencyClass(skill.proficiencyLevel)">
                            {{skill.proficiencyLevel | titlecase}}
                          </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                          <span [class]="'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ' + getSkillStatusClass(skill.status)">
                            {{skill.status | titlecase}}
                          </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                          {{skill.submittedBy}}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                          {{skill.submittedAt | date}}
                        </td>
                      </tr>
                    }
                  </tbody>
                </table>
                @if (organizationSkills.length === 0) {
                  <div class="text-center py-12">
                    <lucide-icon name="briefcase" class="mx-auto h-12 w-12 text-gray-400"></lucide-icon>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">No skills added</h3>
                    <p class="mt-1 text-sm text-gray-500">Get started by adding your first organization skill.</p>
                    <div class="mt-6">
                      <button
                        (click)="showAddSkillModal = true"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        Add Skill
                      </button>
                    </div>
                  </div>
                }
              </div>
            </div>
          }
        }
      </div>
    </div>

    <!-- Resource Modal -->
    @if (showResourceModal) {
      <app-resource-modal (close)="showResourceModal = false"></app-resource-modal>
    }

    <!-- Apply Resource Modal -->
    @if (showApplyModal) {
      <app-apply-resource-modal 
        [requirementId]="selectedRequirementId"
        (close)="closeApplyModal()">
      </app-apply-resource-modal>
    }

    <!-- Add User Modal -->
    @if (showAddUserModal) {
      <app-add-user-modal (close)="showAddUserModal = false"></app-add-user-modal>
    }

    <!-- Add Skill Modal -->
    @if (showAddSkillModal) {
      <app-add-skill-modal (close)="showAddSkillModal = false"></app-add-skill-modal>
    }
  </div>
</app-layout>